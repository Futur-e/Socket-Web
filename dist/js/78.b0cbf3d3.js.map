{"version":3,"file":"js/78.b0cbf3d3.js","mappings":"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","sources":["webpack://socket_chat_vue3/./src/views/File.vue?d186","webpack://socket_chat_vue3/./src/api/files.ts","webpack://socket_chat_vue3/./src/views/File.vue?2b2c","webpack://socket_chat_vue3/./src/views/File.vue"],"sourcesContent":["import { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, withModifiers as _withModifiers, createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, vShow as _vShow, createVNode as _createVNode, withDirectives as _withDirectives, withCtx as _withCtx, createBlock as _createBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-2732e7f7\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = { class: \"group-date\" }\nconst _hoisted_2 = { class: \"group-container\" }\nconst _hoisted_3 = [\"title\"]\nconst _hoisted_4 = { class: \"item-cover\" }\nconst _hoisted_5 = [\"src\"]\nconst _hoisted_6 = [\"src\"]\nconst _hoisted_7 = { class: \"file-name\" }\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  const _component_loading = _resolveComponent(\"loading\")!\n  const _component_scroll_box = _resolveComponent(\"scroll-box\")!\n\n  return (_openBlock(), _createBlock(_component_scroll_box, {\n    class: \"file\",\n    listenHeight: \"\",\n    topDisabled: \"\",\n    bottomDisabled: _ctx.disabled,\n    onTouchBottom: _cache[1] || (_cache[1] = ($event: any) => (_ctx.getFileList(_ctx.fileList[_ctx.fileList.length - 1][_ctx.fileList[_ctx.fileList.length - 1].length - 1].createdAt)))\n  }, {\n    default: _withCtx(() => [\n      (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.fileList, (item) => {\n        return (_openBlock(), _createElementBlock(\"div\", {\n          class: \"file-group\",\n          key: item[0].createdAt\n        }, [\n          _createElementVNode(\"div\", _hoisted_1, _toDisplayString(_ctx.timeHandler(item[0].createdAt)), 1),\n          _createElementVNode(\"div\", _hoisted_2, [\n            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(item, (i) => {\n              return (_openBlock(), _createElementBlock(\"div\", {\n                class: \"group-item\",\n                key: i.createdAt,\n                title: `大小: ${i.size} B\\n创建时间戳: ${i.createdAt}\\n地址: ${i.src}`\n              }, [\n                _createElementVNode(\"div\", _hoisted_4, [\n                  (i.type === 1)\n                    ? (_openBlock(), _createElementBlock(\"img\", {\n                        key: 0,\n                        src: i.src,\n                        alt: \"\",\n                        onClick: _cache[0] || (_cache[0] = _withModifiers(\n//@ts-ignore\n(...args) => (_ctx.checkImg && _ctx.checkImg(...args)), [\"stop\"]))\n                      }, null, 8, _hoisted_5))\n                    : (i.type === 2)\n                      ? (_openBlock(), _createElementBlock(\"img\", {\n                          key: 1,\n                          src: require('@/assets/img/fileImg.png'),\n                          alt: \"\"\n                        }, null, 8, _hoisted_6))\n                      : _createCommentVNode(\"\", true)\n                ]),\n                _createElementVNode(\"div\", _hoisted_7, _toDisplayString(i.fileName), 1)\n              ], 8, _hoisted_3))\n            }), 128))\n          ])\n        ]))\n      }), 128)),\n      _withDirectives(_createVNode(_component_loading, { class: \"loading\" }, null, 512), [\n        [_vShow, !_ctx.disabled]\n      ])\n    ]),\n    _: 1\n  }, 8, [\"bottomDisabled\"]))\n}","import { FileItem } from '@/type'\r\nimport request from '@/utils/request'\r\n\r\n// 获取文件列表\r\nexport function api_getFileList(params: { lastTime?: number }) {\r\n  return request.get('/files/get_file_list', { params }) as unknown as getFileListType\r\n}\r\n\r\ntype getFileListType = {\r\n  code: number,\r\n  list: FileItem[],\r\n}","\r\nimport { api_getFileList } from '@/api/files'\r\nimport ScrollBox from '@/components/ScrollBox.vue'\r\nimport Loading from '@/components/Loading.vue'\r\n\r\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n// @ts-ignore\r\nimport Pubsub from 'pubsub-js'\r\nimport moment from 'moment'\r\nimport { computed, defineComponent, onMounted, reactive, toRefs } from 'vue'\r\nimport { FileItem } from '@/type'\r\n\r\nexport default defineComponent({\r\n  components: { ScrollBox, Loading },\r\n  name: 'file-page',\r\n  setup() {\r\n    const state: State = reactive({\r\n      fileList: [],\r\n      // 禁止加载新数据\r\n      disabled: false,\r\n    })\r\n    const compute = {\r\n      timeHandler: computed(() => {\r\n        return function (time: string) {\r\n          return moment(parseInt(time)).format('yyyy-MM-DD')\r\n        }\r\n      }),\r\n    }\r\n\r\n    // 生命周期\r\n    onMounted(() => {\r\n      getFileList()\r\n    })\r\n\r\n    // methods\r\n    // 请求文件列表\r\n    const getFileList = async (lastTime?: number) => {\r\n      state.disabled = true\r\n\r\n      let res = await api_getFileList({ lastTime })\r\n\r\n      if (res) {\r\n        groupByTime(res.list)\r\n        state.disabled = res.list.length < 30\r\n      }\r\n    }\r\n\r\n    // 将新增列表按照时间进行分组\r\n    const groupByTime = (newList: FileItem[]) => {\r\n      newList.forEach((item) => {\r\n        if (!state.fileList.length) {\r\n          state.fileList.push([item])\r\n        } else {\r\n          let time = state.fileList[state.fileList.length - 1][0].createdAt\r\n          if (moment(parseInt(time)).isSame(moment(parseInt(item.createdAt)), 'date')) {\r\n            state.fileList[state.fileList.length - 1].push(item)\r\n          } else {\r\n            state.fileList.push([item])\r\n          }\r\n        }\r\n      })\r\n      console.log(state.fileList)\r\n    }\r\n\r\n    const checkImg = (e: MouseEvent) => {\r\n      Pubsub.publish('viewPicture', e.target)\r\n    }\r\n\r\n    return {\r\n      ...toRefs(state),\r\n      ...compute,\r\n      checkImg,\r\n      groupByTime,\r\n      getFileList,\r\n    }\r\n  },\r\n})\r\n\r\ninterface State {\r\n  disabled: boolean\r\n  fileList: FileItem[][]\r\n}\r\n","import { render } from \"./File.vue?vue&type=template&id=2732e7f7&scoped=true&ts=true\"\nimport script from \"./File.vue?vue&type=script&lang=ts\"\nexport * from \"./File.vue?vue&type=script&lang=ts\"\n\nimport \"./File.vue?vue&type=style&index=0&id=2732e7f7&scoped=true&lang=css\"\n\nimport exportComponent from \"D:\\\\ubantu lts\\\\wwwroot\\\\socket_chat_vue3\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-2732e7f7\"]])\n\nexport default __exports__"],"names":["_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","render","_ctx","_cache","$props","$setup","$data","$options","_component_loading","_resolveComponent","_component_scroll_box","_openBlock","_createBlock","listenHeight","topDisabled","bottomDisabled","disabled","onTouchBottom","$event","getFileList","fileList","length","createdAt","default","_withCtx","_createElementBlock","_Fragment","_renderList","item","key","_createElementVNode","_toDisplayString","timeHandler","i","title","size","src","type","alt","onClick","_withModifiers","args","checkImg","require","_createCommentVNode","fileName","_withDirectives","_createVNode","_vShow","_","api_getFileList","params","request","defineComponent","components","ScrollBox","Loading","name","setup","state","reactive","compute","computed","time","moment","parseInt","format","onMounted","async","res","lastTime","groupByTime","list","newList","forEach","isSame","push","e","Pubsub","target","toRefs","__exports__"],"sourceRoot":""}